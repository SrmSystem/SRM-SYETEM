ALTER TABLE QEWEB_CHECK_ITEM
ADD ( "REC_ITEM_ID" NUMBER) 
ADD ( "SOURCE" NUMBER ) 
ADD ( "ORDER_CODE" NVARCHAR2(50) NULL  ) 
ADD ( "ITEM_NO" NUMBER ) 
ADD ( "ZHD" NUMBER ) 
ADD ( "MATERIAL_ID" NUMBER) ;

update QEWEB_CHECK_ITEM set source=1 where source is null;

COMMENT ON COLUMN "QEWEB_CHECK_ITEM "."REC_ITEM_ID" IS '退货单ID';
COMMENT ON COLUMN "QEWEB_CHECK_ITEM "."SOURCE" IS '对账明细来源 1：收货   -1：退货';
COMMENT ON COLUMN "QEWEB_CHECK_ITEM "."ORDER_CODE" IS '采购订单号';
COMMENT ON COLUMN "QEWEB_CHECK_ITEM "."ITEM_NO" IS '行号';
COMMENT ON COLUMN "QEWEB_CHECK_ITEM "."ZHD" IS '含税价';
COMMENT ON COLUMN "QEWEB_CHECK_ITEM "."MATERIAL_ID" IS '物料ID';

ALTER TABLE QEWEB_PURCHASE_ORDER_ITEM
ADD ('BALANCE_STATUS' NUMBER) ;
COMMENT ON COLUMN QEWEB_PURCHASE_ORDER_ITEM"."BALANCE_STATUS" IS '对账状态0未对账  1已对账';

update QEWEB_PURCHASE_ORDER_ITEM set BALANCE_STATUS=0 where BALANCE_STATUS is null;

ALTER TABLE QEWEB_PURCHASE_ORDER_ITEM
ADD ('BALANCE_STATUS' NUMBER) ;
COMMENT ON COLUMN QEWEB_PURCHASE_ORDER_ITEM"."BALANCE_STATUS" IS '对账状态0未对账  1已对账';

update QEWEB_PURCHASE_ORDER_ITEM set BALANCE_STATUS=0 where BALANCE_STATUS is null;

create view VIEW_NO_CHECK_ITEM as
select ROWNUM as ID,aa."DLV_CODE",aa."BUYER_CODE",aa."BUYER_NAME",aa."VENDOR_CODE",aa."VENDOR_NAME",aa."REC_CODE",aa."REC_QTY",aa."RETURN_CODE",aa."RETURN_TIME",aa."ORDER_CODE",aa."ITEM_NO",aa."MATERIAL_CODE",aa."MATERIAL_NAME",aa."UNIT_NAME",aa."CREATE_TIME",aa."REC_ITEM_ID",aa."REC_ID",aa."DLV_ITEM_ID",aa."DLV_ID",aa."ORDER_ITEM_ID",aa."ORDER_ID",aa."MATERIAL_ID",aa."BUYER_ID",aa."VENDOR_ID",aa."DATA_TYPE" FROM
(select 
dlv.DELIVERY_CODE DLV_CODE,
buyer.CODE BUYER_CODE,
buyer.NAME BUYER_NAME,
ven.CODE VENDOR_CODE,
ven.NAME VENDOR_NAME,
rec.RECEIVE_CODE REC_CODE,
recItem.RECEIVE_QTY REC_QTY,
null RETURN_CODE,
null RETURN_TIME,
ord.ORDER_CODE ORDER_CODE,
orderItem.ITEM_NO ITEM_NO,
material.CODE MATERIAL_CODE,
material.NAME MATERIAL_NAME,
orderItem.UNIT_NAME UNIT_NAME,
recItem.CREATE_TIME CREATE_TIME,
recItem.ID REC_ITEM_ID,
rec.ID REC_ID,
dlvItem.ID DLV_ITEM_ID,
dlv.ID DLV_ID,
orderItem.ID ORDER_ITEM_ID,
ord.ID ORDER_ID,
material.ID MATERIAL_ID,
buyer.ID BUYER_ID,
ven.ID VENDOR_ID,
'1' DATA_TYPE
from QEWEB_RECEIVE_ITEM recItem 
join QEWEB_RECEIVE rec on recItem.RECEIVE_ID = rec.ID
join QEWEB_DELIVERY_ITEM dlvItem on recItem.DELIVERY_ITEM_ID = dlvItem.ID
join QEWEB_DELIVERY dlv on dlvItem.DELIVERY_ID = dlv.ID
join QEWEB_PURCHASE_ORDER_ITEM orderItem on orderItem.ID = recItem.ORDER_ITEM_ID
join QEWEB_PURCHASE_ORDER ord on orderItem.ORDER_ID = ord.ID
join QEWEB_ORGANIZATION buyer on ord.BUYER_ID = buyer.ID
join QEWEB_ORGANIZATION ven on ord.VENDOR_ID = ven.ID
join QEWEB_MATERIAL material on orderItem.MATERIAL_ID = material.ID
where recItem.BALANCE_STATUS=0 and recItem.ABOLISHED = 0
UNION ALL 
select 
null DLV_CODE,
buyer.CODE BUYER_CODE,
buyer.NAME BUYER_NAME,
ven.CODE VENDOR_CODE,
ven.NAME VENDOR_NAME,
null REC_CODE,
null REC_QTY,
ord.ORDER_CODE RETURN_CODE,
orderItem.CREATE_TIME RETURN_TIME,
ord.ORDER_CODE ORDER_CODE,
orderItem.ITEM_NO ITEM_NO,
material.CODE MATERIAL_CODE,
material.NAME MATERIAL_NAME,
orderItem.UNIT_NAME UNIT_NAME,
orderItem.CREATE_TIME CREATE_TIME,
null REC_ITEM_ID,
null REC_ID,
null DLV_ITEM_ID,
null DLV_ID,
orderItem.ID ORDER_ITEM_ID,
ord.ID ORDER_ID,
material.ID MATERIAL_ID,
buyer.ID BUYER_ID,
ven.ID VENDOR_ID,
'-1' DATA_TYPE
from QEWEB_PURCHASE_ORDER_ITEM orderItem
join QEWEB_PURCHASE_ORDER ord on orderItem.ORDER_ID = ord.ID
join QEWEB_ORGANIZATION buyer on ord.BUYER_ID = buyer.ID
join QEWEB_ORGANIZATION ven on ord.VENDOR_ID = ven.ID
join QEWEB_MATERIAL material on orderItem.MATERIAL_ID = material.ID
where orderItem.BALANCE_STATUS=0 and orderItem.RETPO='X' and orderItem.PUBLISH_STATUS='1' and orderItem.ABOLISHED = 0) aa